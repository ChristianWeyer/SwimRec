var swimmersUrl="http://mobile.dsv.de/json/getswimmers?firstname={0}&lastname={1}",recordsUrl="http://mobile.dsv.de/json/getrecords?swimmerid={0}",events="25F 50F 100F 200F 400F 800F 1500F 25B 50B 100B 200B 25R 50R 100R 200R 25S 50S 100S 200S 100L 200L 400L".split(" "),store,currentSwimmer={},currentSwimmerName="-",currentSwimmerRecords={},currentLocalSwimmerData={},foundSwimmers={};
$(document).ready(function(a){a.support.cors=!0;window.addEventListener("load",function(){window.applicationCache&&window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY?(console.log("Browser downloaded a new app cache."),window.applicationCache.swapCache(),confirm("Neue Version vorhanden - jetzt laden?")&&window.location.reload()):console.log("Manifest didnt change.")},!1)},!1);store=new Lawnchair({name:"swimrec",adapter:"dom"},
function(){});a("#addFavorite").click(function(){saveFavorite()});a("#refreshFavs").click(function(){refreshFavoritesRecords()});a("#searchSwimmer").click(function(){searchSwimmers()});toastr.options={positionClass:"toast-top-left"};NotifierjsConfig.defaultTimeOut=1250;NotifierjsConfig.position=["top","left"]});function showLoader(a){kendoMobileApplication.pane.loader.element.find("h1").removeClass("loaderHeading").text(a);kendoMobileApplication.showLoading()}
function hideLoader(){kendoMobileApplication.hideLoading()}function resultsViewInit(){var a=this.element.find("ul.km-listview");$("#laneSelect").kendoMobileButtonGroup({select:function(){a.hide().eq(this.selectedIndex).show()},index:0})}function showDialog(a){$("#"+a).data("kendoMobileModalView").open()}function closeModalView(a){a.sender.element.closest("[data-role=modalview]").data("kendoMobileModalView").close()}function clearFavoritesFromModalView(a){clearFavorites();closeModalView(a)}
function saveFavorite(){var a="Swimmer_"+currentSwimmer.SwimmerID+"_Data";currentLocalSwimmerData.Swimmer=currentSwimmer;currentLocalSwimmerData.Records=currentSwimmerRecords;store.save({key:a,localSwimmer:currentLocalSwimmerData},function(){Notifier.success(currentSwimmerName,"Gespeichert.")})}
function loadFavorites(){var a=[];store.each(function(b){a.push({SwimmerID:b.localSwimmer.Swimmer.SwimmerID,Firstname:b.localSwimmer.Swimmer.Firstname,Lastname:b.localSwimmer.Swimmer.Lastname})});var b=_.sortBy(a,function(a){return a.Firstname}),c=kendo.template($("#favoritesTemplate").text());$("#favoritesSwimmer").html(c(b));kendo.mobile.init($("#favoritesSwimmer"))}function clearFavorites(){store.nuke();$("#favoritesSwimmer li").remove()}
function displayFavorite(a){store.get("Swimmer_"+a+"_Data",function(a){currentSwimmer=a.localSwimmer.Swimmer;currentSwimmerRecords=a.localSwimmer.Records;currentSwimmerName=currentSwimmer.Firstname+" "+currentSwimmer.Lastname;window.kendoMobileApplication.navigate("#recordsResultsPage");bindSwimmer(currentSwimmerRecords);bindRecordsTables(currentSwimmerRecords)})}
function refreshFavoritesRecords(){showLoader("Aktualisiere..");var a=refreshFavoritesRecordsCore();$.when.apply(null,a).done(function(){hideLoader()})}
function refreshFavoritesRecordsCore(){var a=[];store.each(function(b){var c=recordsUrl.replace("{0}",b.localSwimmer.Swimmer.SwimmerID);a.push($.ajax({url:c,cache:!1,type:"GET",processData:!1,contentType:"application/json; charset=utf-8",error:function(a){hideLoader();alert(a)},success:function(a){b.localSwimmer.Records=a;store.save({key:b.key,localSwimmer:b.localSwimmer},function(){})}}))});return a}
function searchSwimmers(){showLoader("Suche...");var a=$("#search").val().split(" "),b=a[0],c=a[1],a=swimmersUrl.replace("{0}",b).replace("{1}",c);$.ajax({url:a,cache:!1,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",error:function(){hideLoader();showDialog("serviceErrorDialog")},success:function(a){foundSwimmers=a;currentSwimmerName=b+" "+c;null==foundSwimmers||""==foundSwimmers?(showDialog("swimmerErrorDialog"),hideLoader()):1<foundSwimmers.length?(a=kendo.template($("#swimmersTemplate").text()),
$("#searchResultList").html(a(foundSwimmers)),kendo.mobile.init($("#searchResultList")),hideLoader(),window.kendoMobileApplication.navigate("#swimmerResultsPage")):searchRecords(foundSwimmers[0].SwimmerID,!1,!0)}})}
function searchRecords(a,b,c){b&&showLoader("Suche...");b=recordsUrl.replace("{0}",a);$.ajax({url:b,cache:!1,type:"GET",processData:!1,contentType:"application/json; charset=utf-8",error:function(){hideLoader();showDialog("serviceErrorDialog")},success:function(b){currentSwimmer=_.find(foundSwimmers,function(b){return b.SwimmerID==a});currentSwimmerRecords=b;c&&(window.kendoMobileApplication.navigate("#recordsResultsPage"),bindSwimmer(currentSwimmerRecords),bindRecordsTables(currentSwimmerRecords));
hideLoader()}})}function bindSwimmer(){$("#currentSwimmerRecords").text(currentSwimmerName)}
function bindRecordsTables(a){var b=a[0].Times,c=a[1].Times,e=[],d=0;b.forEach(function(a){a<c[d]&&""!=a||""==c[d]?e.push(a):e.push(c[d]);d++});a=kendo.template($("#resultsTemplate").text());$("#recordsList25m").html(a(b));$("#recordsList50m").html(a(c));$("#recordsListTotal").html(a(e));kendo.mobile.init($("#recordsList25m"));kendo.mobile.init($("#recordsList50m"));kendo.mobile.init($("#recordsListTotal"))};